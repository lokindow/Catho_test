import{Directive,ElementRef,Injectable,Input,NgModule,TemplateRef,ViewContainerRef}from"@angular/core";import{AMBAuthorization,AMBRolesMapping,AMBServiceContainer,AMBServiceType}from"@amb/core";import{Subject}from"rxjs/rx";var AMBAllowedRolesDirective=function(){function e(e,t,i,r){var o=this;this._elem=e,this.templateRef=i,this.viewContainer=r,this.hasView=!1,this._authorizationService=t,this._authorizationService.observable.subscribe(function(e){o.applyPermission()})}return e.prototype.ngOnInit=function(){this.applyPermission()},e.prototype.applyPermission=function(){var e=this._authorizationService.hasOneDefined(this.roles);!e&&this.hasView?(this.viewContainer.clear(),this.hasView=!1):e&&!this.hasView&&(this.viewContainer.createEmbeddedView(this.templateRef),this.hasView=!0)},Object.defineProperty(e.prototype,"ambAllowedRoles",{set:function(e){this.roles=e},enumerable:!0,configurable:!0}),e.decorators=[{type:Directive,args:[{selector:"[ambAllowedRoles]"}]}],e.ctorParameters=function(){return[{type:ElementRef},{type:AMBAuthorization},{type:TemplateRef},{type:ViewContainerRef}]},e.propDecorators={ambAllowedRoles:[{type:Input}]},e}(),AMBDeniedRolesDirective=function(){function e(e,t,i,r){var o=this;this._elem=e,this.templateRef=i,this.viewContainer=r,this.hasView=!1,this._authorizationService=t,this._authorizationService.observable.subscribe(function(e){o.applyPermission()})}return e.prototype.ngOnInit=function(){this.applyPermission()},e.prototype.applyPermission=function(){var e=this._authorizationService.hasOneDefined(this.roles);e&&this.hasView?(this.viewContainer.clear(),this.hasView=!1):e||this.hasView||(this.viewContainer.createEmbeddedView(this.templateRef),this.hasView=!0)},Object.defineProperty(e.prototype,"ambDeniedRoles",{set:function(e){this.roles=e},enumerable:!0,configurable:!0}),e.decorators=[{type:Directive,args:[{selector:"[ambDeniedRoles]"}]}],e.ctorParameters=function(){return[{type:ElementRef},{type:AMBAuthorization},{type:TemplateRef},{type:ViewContainerRef}]},e.propDecorators={ambDeniedRoles:[{type:Input}]},e}(),AMBAuthorizationService=function(){function e(){this._subject=new Subject,this._observable=this._subject.asObservable(),this._logger=AMBServiceContainer.get(AMBServiceType.Logger.ConsoleLogger)}return e.prototype.hasDefined=function(e){return"string"==typeof e&&void 0!==this._ambUser&&this._ambUser.roles.indexOf(e.toUpperCase())>-1},e.prototype.hasOneDefined=function(e){var t=this;if(!Array.isArray(e))throw"roles parameter is not array.";return void 0!==this._ambUser&&void 0!==this._ambUser.roles&&e.some(function(e){if("string"==typeof e)return t._ambUser.roles.indexOf(e.toUpperCase())>-1})},e.prototype.emitChanges=function(e,t){this._ambUser=e,void 0!==this._ambUser&&this._logger.log('Emitindo alteações "'+t+'" para o usuário '+this._ambUser.username+" no serviço de autorização",2),this._subject.next(t)},Object.defineProperty(e.prototype,"observable",{get:function(){return this._observable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ambUser",{set:function(e){this._ambUser=e,void 0!==this._ambUser&&this._logger.log("Setando o usuário "+this._ambUser+" no serviço de autorização",2)},enumerable:!0,configurable:!0}),e.decorators=[{type:Injectable}],e.ctorParameters=function(){return[]},e}(),__extends=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),AMBDefaultRolesMapping=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.decorators=[{type:Injectable}],t.ctorParameters=function(){return[]},t}(AMBRolesMapping),AMBAuthorizationModule=function(){function e(){}return e.forRoot=function(){return{ngModule:e,providers:[{provide:AMBRolesMapping,useClass:AMBDefaultRolesMapping},{provide:AMBAuthorization,useClass:AMBAuthorizationService}]}},e.decorators=[{type:NgModule,args:[{declarations:[AMBAllowedRolesDirective,AMBDeniedRolesDirective],imports:[],exports:[AMBAllowedRolesDirective,AMBDeniedRolesDirective]}]}],e.ctorParameters=function(){return[]},e}();export{AMBAuthorizationModule,AMBAllowedRolesDirective,AMBDeniedRolesDirective,AMBAuthorizationService};