"use strict";var __decorate=this&&this.__decorate||function(e,t,r,o){var n,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,o);else for(var c=e.length-1;c>=0;c--)(n=e[c])&&(a=(i<3?n(a):i>3?n(t,r,a):n(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__param=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};Object.defineProperty(exports,"__esModule",{value:!0});var Rx_1=require("rxjs/Rx"),inversify_1=require("inversify"),core_1=require("@amb/core"),amb_arq_execution_exception_1=require("../exceptions/amb.arq-execution-exception"),config_1=require("@amb/config"),amb_app_execution_exception_1=require("../exceptions/amb.app-execution-exception"),amb_creator_request_1=require("./amb.creator.request"),AMBGenericObservableAdapter=function(){function e(e,t){this._logger=e,this._storage=t,this._baseUrl=config_1.AMBApplicationConfig.webServiceUrl}return e.prototype.invoke=function(e){return this.doRequest(e)},e.prototype.doRequest=function(e){var t=this,r=this,o=new amb_creator_request_1.AMBCreatorRequest(this._storage).postRequest(this.adapterContext,e);return r._logger.log("Executando POST com os seguintes dados",2),r._logger.log(JSON.stringify(e),2),Rx_1.Observable.ajax(o).map(function(e){return e=e.response,r._logger.log("Request efetuado com sucesso, dados de resposta:",2),r._logger.log(e,2),e}).catch(function(e){var o;console.log(e),r._logger.log("Erro executando o adaptador: "+t.adapterContext,4),r._logger.log(JSON.stringify(e),4);var n=core_1.AMBSeveridade.ERROR;if(e.response&&"app"===e.response.errType&&(n=core_1.AMBSeveridade.INFO),500!==e.status&&400!==e.status||null===e.response)if(401===e.status){var i="Acesso não autorizado. Favor realizar login na aplicação.";o=n===core_1.AMBSeveridade.ERROR?new amb_arq_execution_exception_1.AMBArchitectureExecutionException(i,n,e.status.toString()):new amb_app_execution_exception_1.AMBApplicationExecutionException(i,n,e.status.toString())}else if(e.xhr&&e.xhr.response)o=n===core_1.AMBSeveridade.ERROR?new amb_arq_execution_exception_1.AMBArchitectureExecutionException(e.message,n,e.status.toString()):new amb_app_execution_exception_1.AMBApplicationExecutionException(e.message,n,e.status.toString());else{i="Servidor ou rede inacessível.";o=n===core_1.AMBSeveridade.ERROR?new amb_arq_execution_exception_1.AMBArchitectureExecutionException(i,n):new amb_app_execution_exception_1.AMBApplicationExecutionException(i,n)}else o=n===core_1.AMBSeveridade.ERROR?new amb_arq_execution_exception_1.AMBArchitectureExecutionException(e.response.message,n,e.response.code,e.response.errType,e.response.msgInterna):new amb_app_execution_exception_1.AMBApplicationExecutionException(e.response.message,n,e.response.code,e.response.errType,e.response.msgInterna);throw o})},e=__decorate([inversify_1.injectable(),__param(0,inversify_1.inject(core_1.AMBServiceType.Logger.ConsoleLogger)),__param(1,inversify_1.inject(core_1.AMBServiceType.AMBStorage)),__metadata("design:paramtypes",[Object,core_1.AMBStorage])],e)}();exports.AMBGenericObservableAdapter=AMBGenericObservableAdapter;var AMBGenericRequestType=function(){return function(){}}();exports.AMBGenericRequestType=AMBGenericRequestType;